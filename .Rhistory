newark_weather_delays_log <- newark_weather_delays %>%
mutate(dep_delay_log = log(dep_delay),
visib_log = log(visib),
wind_gust_log = log(wind_gust),
wind_speed_log = log(wind_speed)) %>%
select(-c("visib", "wind_gust", "wind_speed"))
newark_weather_delays_log %>%
gather() %>%
ggplot() +
geom_histogram(mapping = aes(x = value, fill = key), colour = "black") +
facet_wrap(~ key, scales = "free") +
theme_minimal()
newark_weather_delays_log <- newark_weather_delays %>%
mutate(dep_delay_log = log(dep_delay),
visib_log = log(visib),
wind_gust_log = log(wind_gust),
wind_speed_log = log(wind_speed)) %>%
select(-c("dep_delay", "visib", "wind_gust", "wind_speed"))
newark_weather_delays_log %>%
gather() %>%
ggplot() +
geom_histogram(mapping = aes(x = value, fill = key), colour = "black") +
facet_wrap(~ key, scales = "free") +
theme_minimal()
cor(newark_weather_delays_log[, c("dep_delay_log", "wind_dir",
"wind_speed_log", "wind_gust_log", "visib_log")])
newark_weather_delays_log <- newark_weather_delays %>%
mutate(dep_delay_log = log(dep_delay),
visib_log = log(visib),
wind_gust_log = log(wind_gust + 0.1),
wind_speed_log = log(wind_speed + 0.1)) %>%
select(-c("dep_delay", "visib", "wind_gust", "wind_speed"))
newark_weather_delays_log %>%
gather() %>%
ggplot() +
geom_histogram(mapping = aes(x = value, fill = key), colour = "black") +
facet_wrap(~ key, scales = "free") +
theme_minimal()
newark_weather_delays_log <- newark_weather_delays %>%
mutate(dep_delay_log = log(dep_delay),
visib_log = log(visib),
wind_gust_log = log(wind_gust + 1),
wind_speed_log = log(wind_speed + 1)) %>%
select(-c("dep_delay", "visib", "wind_gust", "wind_speed"))
newark_weather_delays_log %>%
gather() %>%
ggplot() +
geom_histogram(mapping = aes(x = value, fill = key), colour = "black") +
facet_wrap(~ key, scales = "free") +
theme_minimal()
newark_weather_delays_log <- newark_weather_delays %>%
mutate(dep_delay = log(dep_delay),
visib_log = log(visib),
wind_gust_log = log(wind_gust + 1), # to avoid -Infinity
wind_speed_log = log(wind_speed + 1)) %>% # to avoid -Infinity
select(-c("dep_delay", "visib", "wind_gust", "wind_speed"))
newark_weather_delays_log %>%
gather() %>%
ggplot() +
geom_histogram(mapping = aes(x = value, fill = key), colour = "black") +
facet_wrap(~ key, scales = "free") +
theme_minimal()
newark_weather_delays_log <- newark_weather_delays %>%
mutate(dep_delay_log = log(dep_delay),
visib_log = log(visib),
wind_gust_log = log(wind_gust + 1), # to avoid -Infinity
wind_speed_log = log(wind_speed + 1)) %>% # to avoid -Infinity
select(-c("dep_delay", "visib", "wind_gust", "wind_speed"))
newark_weather_delays_log %>%
gather() %>%
ggplot() +
geom_histogram(mapping = aes(x = value, fill = key), colour = "black") +
facet_wrap(~ key, scales = "free") +
theme_minimal()
cor(newark_weather_delays_log[, c("dep_delay_log", "wind_dir",
"wind_speed_log", "wind_gust_log", "visib_log")])
cor(newark_weather_delays_log[, c("dep_delay_log", "wind_dir",
"wind_speed_log", "wind_gust_log", "visib_log")])
weather_delays_mod1 <- lm(data = newark_weather_delays_log, dep_delay_log ~ .)
summary(weather_delays_mod1)
newark_weather_delays_log <- newark_weather_delays %>%
mutate(visib_log = log(visib),
wind_gust_log = log(wind_gust + 1), # to avoid -Infinity
wind_speed_log = log(wind_speed + 1)) %>% # to avoid -Infinity
select(-c("visib", "wind_gust", "wind_speed"))
newark_weather_delays_log %>%
gather() %>%
ggplot() +
geom_histogram(mapping = aes(x = value, fill = key), colour = "black") +
facet_wrap(~ key, scales = "free") +
theme_minimal()
cor(newark_weather_delays_log[, c("dep_delay", "wind_dir",
"wind_speed_log", "wind_gust_log", "visib_log")])
weather_delays_mod1 <- lm(data = newark_weather_delays_log, dep_delay_log ~ .)
weather_delays_mod1 <- lm(data = newark_weather_delays_log, dep_delay ~ .)
summary(weather_delays_mod1)
autoplot(weather_delays_mod1)
library(ggfortify)
autoplot(weather_delays_mod1)
autoplot(weather_delays_mod1)
newark_weather_delays %>%
gather() %>%
ggplot() +
geom_point(mapping = aes(x = value, y = dep_delay), colour = "black") +
facet_wrap(~ key, scales = "free") +
theme_minimal()
newark_weather_delays %>%
gather() %>%
ggplot() +
geom_point(mapping = aes(x = value, y = dep_delay, fill = key), colour = "black") +
facet_wrap(~ key, scales = "free") +
theme_minimal()
newark_weather_delays %>%
gather() %>%
ggplot() +
geom_point(mapping = aes(x = value, y = dep_delays, fill = key), colour = "black") +
facet_wrap(~ key, scales = "free") +
theme_minimal()
newark_weather_delays %>%
gather() %>%
ggplot() +
aes(x = dep_delay, y = visib) +
geom_point() +
theme_minimal()
glimpse(newark_weather_delays)
newark_weather_delays %>%
gather() %>%
ggplot() +
aes(x = dep_delay, y = visib) +
geom_point() +
theme_minimal()
glimpse(newark_weather_delays)
newark_weather_delays %>%
ggplot() +
aes(x = dep_delay, y = visib) +
geom_point()
pairs(newark_weather_delays[c("dep_delay", "wind_dir", "wind_speed", "wind_gust", "visib")])
GGally::ggpairs(newark_weather_delays)
```{r, message=FALSE, warning=FALSE}
GGally::ggpairs(newark_weather_delays)
newark_weather_delays %>%
ggplot() +
aes(x = visib, y = dep_delay) +
geom_point()
pairs(newark_weather_delays[c("dep_delay", "visib", "wind_dir", "wind_gust", "wind_speed")])
pairs(newark_weather_delays[c("dep_delay", "visib_log", "wind_dir_log", "wind_gust_log", "wind_speed_log")])
pairs(newark_weather_delays_log[c("dep_delay", "visib_log", "wind_dir_log", "wind_gust_log", "wind_speed_log")])
pairs(newark_weather_delays_log[c("dep_delay", "visib_log", "wind_dir", "wind_gust_log", "wind_speed_log")])
glimpse(newark_weather_delays)
newark_weather_delays_scale <- newark_weather_delays %>%
mutate_if(is.numeric, scale)
newark_weather_delays %>%
ggplot() +
aes(x = dep_delay, y = visib) +
geom_point()
fviz_nbclust(newark_weather_delays_scale %>%
select(dep_delay, visib),
FUNcluster = kmeans,
method = "wss",
nstart = 20)
library(cluster)
fviz_nbclust(newark_weather_delays_scale %>%
select(dep_delay, visib),
FUNcluster = kmeans,
method = "wss",
nstart = 20)
library(factoextra)
fviz_nbclust(newark_weather_delays_scale %>%
select(dep_delay, visib),
FUNcluster = kmeans,
method = "wss",
nstart = 20)
glimpse(newark_weather_delays)
library(factoextra)
fviz_nbclust(newark_weather_delays_scale %>%
select(dep_delay, wind_speed),
FUNcluster = kmeans,
method = "wss",
nstart = 20)
library(factoextra)
fviz_nbclust(newark_weather_delays_scale %>%
select(dep_delay, wind_gust),
FUNcluster = kmeans,
method = "wss",
nstart = 20)
View(newark_weather_delays)
rm(newark_weather_delays_scale)
newark_weather_delays <- newark_flights_delayed %>%
select(dep_delay, time_hour) %>%
inner_join(newark_weather, by = "time_hour")
glimpse(newark_weather_delays)
newark_weather_delays %>%
select(-time_hour) %>% # remove time stamp
gather() %>%
ggplot() +
geom_histogram(mapping = aes(x = value, fill = key), colour = "black") +
facet_wrap(~ key, scales = "free") +
theme_minimal()
newark_weather_delays_log <- newark_weather_delays %>%
mutate(visib_log = log(visib),
wind_gust_log = log(wind_gust + 1), # to avoid -Infinity
wind_speed_log = log(wind_speed + 1)) %>% # to avoid -Infinity
select(-c("visib", "wind_gust", "wind_speed", "time_hour"))
newark_weather_delays_log %>%
gather() %>%
ggplot() +
geom_histogram(mapping = aes(x = value, fill = key), colour = "black") +
facet_wrap(~ key, scales = "free") +
theme_minimal()
cor(newark_weather_delays_log[, c("dep_delay", "wind_dir",
"wind_speed_log", "wind_gust_log", "visib_log")])
weather_delays_mod1 <- lm(data = newark_weather_delays_log, dep_delay ~ .)
summary(weather_delays_mod1)
autoplot(weather_delays_mod1)
glimpse(newark_weather_delays)
View(newark_flights)
View(flights_data)
View(airports_data)
View(flights_data)
View(newark_flights)
colSums(is.na(newark_flights))
colSums(is.na(newark_weather_delays)
colSums(is.na(newark_weather_delays))
colSums(is.na(newark_weather_delays))
glimpse(newark_weather_delays)
colSums(is.na(newark_flights_delayed))
glimpse(newark_weather_delays)
knitr::opts_chunk$set(echo = FALSE)
library(tidyverse)
library(lubridate)
library(ggfortify)
flights_data <- read_csv("data/flights.csv") %>%
janitor::clean_names()
airports_data <- read_csv("data/airports.csv") %>%
janitor::clean_names()
weather_data <- read_csv("data/weather.csv") %>%
janitor::clean_names()
plane_data <- read_csv("data/planes.csv") %>%
janitor::clean_names()
# capture only newark airport flights
newark_flights <- inner_join(flights_data, airports_data, by = c("origin" = "faa")) %>%
filter(name == "Newark Liberty International Airport") %>%
mutate(date = make_date(year, month, day)) %>% # add date field
mutate(month_name = month(date, label = TRUE)) # add month name
# missing values in newark flights data
colSums(is.na(newark_flights))
# categorise delay times
# delays less than 15 mins are "on time" according to FAA
newark_flights_delayed <- newark_flights %>%
filter(dep_delay > 0) %>%
mutate(delay_category = case_when(
dep_delay > 60 ~ "delays > 1 hr",
dep_delay >= 15 ~ "delays <= 1hr",
TRUE ~ "delays < 15 mins"
))
# number of delayed flights at Newark Airport
newark_flights_delayed %>%
group_by(month_name) %>%
summarise(num_delays = n()) %>%
ggplot() +
aes(x = month_name, y = num_delays) +
geom_col(fill = "lightblue") +
labs(
x = "",
y = "number of delays\n",
title = "Newark Airport - number of delayed flights\n"
) +
theme_grey()
# average flight delay at Newark Airport
newark_flights_delayed %>%
group_by(month_name) %>%
summarise(average_delay = mean(dep_delay)) %>%
ggplot() +
aes(x = month_name, y = average_delay) +
geom_col(fill = "lightblue") +
labs(
x = "",
y = "average delay (mins)\n",
title = "Newark Airport - average flight delay\n") +
theme_grey()
# capture only newark weather
newark_weather <- weather_data %>%
filter(origin == "EWR")
colSums(is.na(newark_weather))
# remove missing values
newark_weather <- newark_weather %>%
select(wind_dir, wind_speed, wind_gust, visib, time_hour) %>%
drop_na()
newark_weather_delays <- newark_flights_delayed %>%
select(dep_delay, time_hour) %>%
inner_join(newark_weather, by = "time_hour")
glimpse(newark_weather_delays)
newark_weather_delays %>%
select(-time_hour) %>% # remove time stamp
gather() %>%
ggplot() +
geom_histogram(mapping = aes(x = value, fill = key), colour = "black") +
facet_wrap(~ key, scales = "free") +
theme_minimal()
newark_weather_delays_log <- newark_weather_delays %>%
mutate(visib_log = log(visib),
wind_gust_log = log(wind_gust + 1), # to avoid -Infinity
wind_speed_log = log(wind_speed + 1)) %>% # to avoid -Infinity
select(-c("visib", "wind_gust", "wind_speed", "time_hour"))
newark_weather_delays_log %>%
gather() %>%
ggplot() +
geom_histogram(mapping = aes(x = value, fill = key), colour = "black") +
facet_wrap(~ key, scales = "free") +
theme_minimal()
cor(newark_weather_delays_log[, c("dep_delay", "wind_dir",
"wind_speed_log", "wind_gust_log", "visib_log")])
weather_delays_mod1 <- lm(data = newark_weather_delays_log, dep_delay ~ .)
summary(weather_delays_mod1)
autoplot(weather_delays_mod1)
glimpse(newark_weather_delays)
newark_weather_delays %>%
select(-time_hour) %>% # remove time stamp
gather() %>%
ggplot() +
geom_histogram(mapping = aes(x = value, fill = key), colour = "black") +
facet_wrap(~ key, scales = "free") +
theme_minimal()
knitr::opts_chunk$set(echo = FALSE)
library(tidyverse)
library(lubridate)
library(ggfortify)
flights_data <- read_csv("data/flights.csv") %>%
janitor::clean_names()
airports_data <- read_csv("data/airports.csv") %>%
janitor::clean_names()
weather_data <- read_csv("data/weather.csv") %>%
janitor::clean_names()
plane_data <- read_csv("data/planes.csv") %>%
janitor::clean_names()
# capture only newark airport flights
newark_flights <- inner_join(flights_data, airports_data, by = c("origin" = "faa")) %>%
filter(name == "Newark Liberty International Airport") %>%
mutate(date = make_date(year, month, day)) %>% # add date field
mutate(month_name = month(date, label = TRUE)) # add month name
# missing values in newark flights data
colSums(is.na(newark_flights))
# categorise delay times
# delays less than 15 mins are "on time" according to FAA
newark_flights_delayed <- newark_flights %>%
filter(dep_delay > 0) %>%
mutate(delay_category = case_when(
dep_delay > 60 ~ "delays > 1 hr",
dep_delay >= 15 ~ "delays <= 1hr",
TRUE ~ "delays < 15 mins"
))
# number of delayed flights at Newark Airport
newark_flights_delayed %>%
group_by(month_name) %>%
summarise(num_delays = n()) %>%
ggplot() +
aes(x = month_name, y = num_delays) +
geom_col(fill = "lightblue") +
labs(
x = "",
y = "number of delays\n",
title = "Newark Airport - number of delayed flights\n"
) +
theme_grey()
# average flight delay at Newark Airport
newark_flights_delayed %>%
group_by(month_name) %>%
summarise(average_delay = mean(dep_delay)) %>%
ggplot() +
aes(x = month_name, y = average_delay) +
geom_col(fill = "lightblue") +
labs(
x = "",
y = "average delay (mins)\n",
title = "Newark Airport - average flight delay\n") +
theme_grey()
# capture only newark weather
newark_weather <- weather_data %>%
filter(origin == "EWR")
colSums(is.na(newark_weather))
# remove missing values
newark_weather_tidy <- newark_weather %>%
select(wind_dir, wind_speed, wind_gust, visib, time_hour) %>%
drop_na()
newark_weather_delays <- newark_flights_delayed %>%
select(dep_delay, time_hour) %>%
inner_join(newark_weather_tidy, by = "time_hour")
# capture only newark airport flights
newark_flights <- inner_join(flights_data, airports_data, by = c("origin" = "faa")) %>%
filter(name == "Newark Liberty International Airport")
glimpse(newark_flights)
colSums(is.na(newark_flights))
dim(newark_flights)
glimpse(newark_flights)
View(newark_flights)
newark_flights %>%
filter(is.na(air_time))
newark_flights %>%
filter(is.na(air_time)) %>%
select(air_time, dep_delay)
colSums(is.na(newark_flights))
glimpse(newark_flights)
newark_flights <- newark_flights %>%
select(-c(name, lat, lon, alt, tz, dst, tzone, origin))
dim(newark_flights)
colSums(is.na(newark_flights))
newark_flights %>%
keep(is.numeric) %>%
summary()
newark_flights %>%
keep(is.character) %>%
summary()
newark_flights %>%
keep(is.numeric) %>%
summary()
newark_flights_clean <- newark_flights %>%
mutate(dep_time = coalesce(dep_time, mean(dep_time, na.rm = TRUE)),
dep_delay = coalesce(dep_delay, mean(dep_delay, na.rm = TRUE)),
arr_time = coalesce(arr_time, mean(arr_time, na.rm = TRUE)),
arr_delay = coalesce(arr_delay, mean(arr_delay, na.rm = TRUE)))
newark_flights_clean %>%
select(dep_time, dep_delay, arr_time, arr_delay) %>%
summary()
newark_flights_clean <- newark_flights_clean %>%
mutate(cancelled = ifelse(is.na(air_time), TRUE, FALSE)) %>%
mutate(air_time = coalesce(air_time, 0))
View(newark_flights_clean)
# capture only newark airport flights
newark_flights <- inner_join(flights_data, airports_data, by = c("origin" = "faa")) %>%
filter(name == "Newark Liberty International Airport")
newark_flights <- newark_flights %>%
select(-c(name, lat, lon, alt, tz, dst, tzone, origin))
colSums(is.na(newark_flights))
newark_flights %>%
keep(is.numeric) %>%
summary()
newark_flights_clean <- newark_flights %>%
mutate(dep_time = coalesce(dep_time, mean(dep_time, na.rm = TRUE)),
dep_delay = coalesce(dep_delay, mean(dep_delay, na.rm = TRUE)),
arr_time = coalesce(arr_time, mean(arr_time, na.rm = TRUE)),
arr_delay = coalesce(arr_delay, mean(arr_delay, na.rm = TRUE)))
newark_flights_clean %>%
select(dep_time, dep_delay, arr_time, arr_delay) %>%
summary()
newark_flights_clean <- newark_flights_clean %>%
mutate(cancelled = ifelse(is.na(air_time), TRUE, FALSE), .after = air_time) %>%
mutate(air_time = coalesce(air_time, 0))
newark_flights_clean %>%
select(cancelled, air_time) %>%
summary()
newark_flights_clean <- newark_flights_clean %>%
mutate(tailnum = ifelse(is.na(tailnum), "ABCXYZ", tailnum))
colSums(is.na(newark_flights_clean))
colSums(is.na(newark_flights_clean))
dim(newark_flights_clean)
# capture only newark airport flights
newark_flights <- inner_join(flights_data, airports_data, by = c("origin" = "faa")) %>%
filter(name == "Newark Liberty International Airport")
glimpse(newark_flights)
newark_flights <- newark_flights %>%
select(-c(name, lat, lon, alt, tz, dst, tzone, origin))
colSums(is.na(newark_flights))
newark_flights_clean <- newark_flights %>%
mutate(dep_time = coalesce(dep_time, mean(dep_time, na.rm = TRUE)),
dep_delay = coalesce(dep_delay, mean(dep_delay, na.rm = TRUE)),
arr_time = coalesce(arr_time, mean(arr_time, na.rm = TRUE)),
arr_delay = coalesce(arr_delay, mean(arr_delay, na.rm = TRUE)))
newark_flights_clean %>%
select(dep_time, dep_delay, arr_time, arr_delay) %>%
summary()
newark_flights_clean <- newark_flights_clean %>%
mutate(cancelled_flight = ifelse(is.na(air_time), TRUE, FALSE), .after = air_time) %>%
mutate(air_time = coalesce(air_time, 0))
newark_flights_clean %>%
select(cancelled_flight, air_time) %>%
summary()
newark_flights_clean <- newark_flights_clean %>%
mutate(tailnum = ifelse(is.na(tailnum), "ABCXYZ", tailnum))
colSums(is.na(newark_flights_clean))
dim(newark_flights_clean)
# capture only newark weather
newark_weather <- weather_data %>%
filter(origin == "EWR")
colSums(is.na(newark_weather))
colSums(is.na(newark_flights_clean))
dim(newark_flights_clean)
# capture only newark weather
newark_weather <- weather_data %>%
filter(origin == "EWR")
# capture only newark weather
newark_weather <- weather_data %>%
filter(origin == "EWR")
glimpse(newark_weather)
colSums(is.na(newark_weather))
newark_weather %>%
keep(is.numeric) %>%
summary()
newark_weather_clean <- newark_weather %>%
select(-c(temp, dewp, humid, precip, pressure, origin))
newark_weather_clean <- newark_weather_clean %>%
mutate(wind_dir = coalesce(wind_dir, mean(wind_dir, na.rm = TRUE)),
wind_speed = coalesce(wind_speed, mean(wind_speed, na.rm = TRUE)),
wind_gust = coalesce(wind_gust, mean(wind_gust, na.rm = TRUE)),
visib = coalesce(visib, mean(visib, na.rm = TRUE)))
newark_weather_clean %>%
select(wind, wind_speed, wind_gust, visib) %>%
summary()
newark_weather_clean %>%
select(wind_dir, wind_speed, wind_gust, visib) %>%
summary()
colSums(is.na(newark_weather_clean))
dim(newark_weather_clean)
