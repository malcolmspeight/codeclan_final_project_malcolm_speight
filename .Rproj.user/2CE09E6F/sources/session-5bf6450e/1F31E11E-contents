---
title: "NYC Citi Bike"
author: "Malcolm Speight"
date: "2022-12-19"
output: html_document
---

```{r setup, echo=FALSE}
knitr::opts_chunk$set(echo = FALSE)
```

```{r, include=FALSE}
library(tidyverse)
library(lubridate)
library(tsibbledata)
library(leaflet)
```

```{r}
nyc_bikes_df <- nyc_bikes
```

```{r}
# create different measures of time in data set
nyc_bikes_df <- nyc_bikes_df %>% 
  mutate(date = date(start_time), .before = start_time) %>% 
  mutate(hour_of_day = hour(start_time), .after = date) %>% 
  mutate(month = month(start_time, label = TRUE), .after = hour_of_day) 
```

```{r}
# add age of user
nyc_bikes_df <- nyc_bikes_df %>% 
  mutate(age = year(today()) - birth_year) 
```

```{r}
# add journey time in mins (rounded up) 
nyc_bikes_df <- nyc_bikes_df %>% 
  mutate(ride_time = ceiling(as.numeric(stop_time - start_time)))
```

```{r}
# remove outliers
nyc_bikes_df <- nyc_bikes_df %>% 
  filter(birth_year > 1942) %>%  # exclude anyone over 80 yrs old
  filter(ride_time < 1440) %>%  # exclude bike rides longer than 24 hours
  filter(gender != "Unknown") # exclude Unknown gender types 
```
<br> <br>

## Domain knowledge (1.1)
<br>
Citi Bike is a privately owned company that operates a bike sharing system serving New York City. There are 25,000 bikes available for hire across the greater New York area. The company is named after the lead sponsor, Citigroup. 

To hire a Citi Bike you need to either purchase annual membership to the scheme or buy a one-day pass on the Citi Bike app. Annual membership provides the user with an unlimited number of 45 minute rides whilst a one-day pass allows an unlimited number of 30 minute rides in one 24 hour period. A single ride of 30 minutes can also be purchased individually. 

Citi Bikes are stored across the city at over 1,500 bike stations. They are locked in a docking station for security and are released at the beginning of a hire using a code obtained from the Citi Bike app or by using a Bike Key. At the end of the ride, the bike should be re-docked securely at a free station anywhere on the network.
<br> <br>

## Business requirements (1.2)
<br>
I received a sample data set from NYC Citi Bike showing the usage of 10 bikes throughout 2018. Included is event data on each trip, including the trip's start and end times and locations. The customer's gender, birth year and bike usage type are also included.

I have been asked by NYC Citi Bike to use this data to answer the following business questions:

* what is the pattern of bikes hires over time?
* do bike hire patterns differ between bike rider demographics?
* what is the geographical spread of the start points of bike hires?
* any other insights?

This report addresses these questions through the interpretation of a series of visualisations. 
<br> <br>

## Business processes and data flow (1.3)
<br>


![NYC Citi Bike process and data flow](./img/Screenshot.png)



<br> <br>

## Data visualisation as a tool for decision-making (1.4)

Patterns in data are much easier to see when presented in a visual form. When reading, the brain must first process the information before being able to form ideas around it. In contrast, visualisation helps people easily digest large amounts of information in just a few seconds. From this, actionable conclusions can be drawn. Hopefully, this report and the presentation of data in a visual form will enable the business to better understand their performance and customer base and also provide for better, more informed decision making. 

<br> <br>

## Data types (1.5)

The dataset contains factor, date-time and numerical data types.

Factor variables (`<fct>`) are used to represent a categorical variable such as 'male' or 'female' and can be either numeric, contain text or a mixture of both. Factor variables in the dataset are `bike_id`, `start_station`, `end_station`, `type` and `gender`.

The data-time data type `<dttm>` contains a date plus a time. These are used for the `start_time` and `stop_time` variables in the data set to accommodate times that span across more than one day. 

All of the numeric variables are of type double (or `<dbl>`) which is the default treatment for numbers and is able to store numbers as decimals. This is appropriate for the longitude and latitude variables but isn't really required for `birth year` which could have been classed as `integer`.
<br> <br>

## Data quality and data bias (1.6)

NYC Citi Bike have 25,000 bikes, 1,500 stations and millions of bike-hires per year. In contrast, the data sample we received was very small with just 10 bikes, 55 stations and about 4,000 journeys. 

The data sample focused exclusively on only one area (Jersey City) rather than being taken from across the operational area of the bike hire scheme.

Such a small sample from a huge population of data does raise questions of selection bias.  

Regarding quality of data, there were 269 entries which stated their gender type as 'Unknown'. Of these, 243 listed their age as '53' years old, spread across both 'Customer' and 'Subscriber' membership types. These records skewed the age distribution considerably and raised questions as to the accuracy of these entries. 

Given that so many user entries listed their age as '53', perhaps a review should be undertaken to determine why this pattern of behaviour was possible when entering the data? Is there a way to prevent or restrict this behaviour in the future? If not, could user data be collected using alternative methods that improve quality?
<br> <br>

## Preparing data for visualisation (1.7)

I felt that the data set was best viewed by slicing the data across different time periods to see what patterns would emerge. To achieve this a variety of different measures of time (date, hour_of_day and month) had to be created from the original `start_time` variable. 

In addition I calculated the age of each customer by subtracting `birth_year` from the current year. 

Finally I dealt with outliers within the data set. 

There were two values for `birth_year` from the 19th century whilst the next oldest was 1947. The two oldest entries were clearly erroneous and excluded by filtering to include only years of birth from 80 years ago (1942). 

Only two bike rides were longer than 24 hours and probably as a result of not docking the bike correctly at the end of the ride. As such, these entries were also excluded. 

Because of doubts surrounding the entries listing their age as '53' and gender 'Unknown', I felt it best to exclude all 269 entries with 'Unknown' gender. Compared to a ~4,000 row data set they were small in number and their ommission would not materially impact the findings or visualisations of this report whereas retaining them would have markedly distorted the age distribution.

It's also worth noting that the original data set of 4,268 observations with 12 variables did not contain any missing or `NA` values. 
<br> <br>

## Process and design (2.1, 2.7, 2.8, 2.9)

I started investigating variables from the NYC Citi Bikes data set on paper. I began by sketching ideas of how I could slice the data to best answer the questions posed by the business. Hire count was clearly the pivotal KPI so I framed my investigation around this: "hire count and seasonality", "hire count and customers" and "hire count and location" were my three areas of focus. 

I outlined my thoughts and potential visualisations on paper and once I had refined these sufficiently began to generate visualisations in `RStudio` using the `ggplot` package. By having a clear plan I was able to generate many plots around a theme and then select those which were most effective. 
<br> <br>

## Visualisations (2.2, 2.3, 2.4, 2.5, 2.6)
<br>

### Bike hires over time

<br>

##### (a) Annual bike hires.

The bar chart below shows how the popularity of bike hires change each month over the course of 2018. 

This chart helps the business better understand why sales change over the year as well as identifying when the business can capitalise on strong demand for their product and when in the year demand is lower, so requiring more effort to boost bike hires.  

Looking at the hire count across the months in the year shows a clear split in usage between Summer and Winter. 

Bike hires reduce considerably in November through to March.

Only in April do we see a marked rise in bike hire numbers. 

Clearly the demand for bike hire reduces in the colder winter months. 

<br>

```{r}
nyc_bikes_df %>% 
  group_by(month) %>% 
  ggplot() + 
  aes(x = month) + 
  geom_bar(fill = "light blue") +
  labs(
    x = "", 
    y = "bike hires\n", 
    title = "Bike hires in 2018", 
  ) +
  theme_grey() + 
  theme(plot.title = element_text(size = 12))
```
<br> <br>

##### (b) Daily bike hires.

The bar chart below shows the average rate at which bikes are hired per hour during a 24 hour period. 

By summarising usage from 2018 and depicting it in a graph, the business can see how bike hires are distributed across an average day and better understand what is driving demand for their product and when and why during the day, demand is lower. 

It's clear from the graph that peak usage is driven by the daily commute, both in the morning and in the evening after work as people return home or go out for the evening across town. 

Between peak hours, bike hires are lower but fairly constant. Off-peak demand is a potential growth area. 

<br>

```{r}
nyc_bikes_df %>% 
  group_by(hour_of_day) %>% 
  ggplot() + 
  aes(x = hour_of_day) + 
  geom_bar(fill = "light blue") +
  scale_x_continuous(breaks = 0:23) +
  labs(
    x = "", 
    y = "bike hires\n", 
    title = "2018 Bike hires across an average 24 hour day"
  ) +
  theme_grey() + 
  theme(plot.title = element_text(size = 12))
```
<br> <br>

### Bike hires and customer demographics

<br>
The plot below shows the volume of bike hires in 2018 by customer age and their gender. This clearly profiles the range of customers NYC Citi Bike has, who their typical customer is and the age and gender of customers with which they are less popular. This allows the business to better understand who they naturally appeal to and who is less inclined to hire a bike from them. This information will enable the business to target advertising and product offerings to the public in a more focused manner. 

The NYC Citi Bike service is most commonly used by men and women in their early to mid 30s.

The vast majority of your customers are male. In fact, males outnumber female customers 3 to 1.

Appealing more to female customers and those over 50 could increase bike hire numbers.  


<br>

```{r}
nyc_bikes_df %>% 
  ggplot() +
  aes(x = age, fill = gender) +
  geom_bar() +
  scale_x_continuous(breaks = c(20, 25, 30, 35, 40, 45, 50, 55, 60, 65, 70, 75)) + 
  labs(
    x = "\nage", 
    y = "bike hires\n", 
    title = "2018 Bike hires by gender"
  ) +
  theme_grey() + 
  theme(plot.title = element_text(size = 12))
```
<br> <br>

### Bike hire start stations

<br> 

The geospatial plot below shows the location and spread of start-stations in the Jersey City area. Clicking on each of the markers will reveal the station number. 

This plot provides the business with a better understanding of the distribution of start-stations. This enables them to better identify redundant stations or areas of overlap where there may be too many stations and lastly, those areas requiring new stations. 

<br>

```{r}
nyc_bikes_df %>% 
  leaflet() %>% 
  addTiles() %>% 
  addMarkers(~start_long, ~start_lat, 
             popup = ~paste(start_station))
```


<br> <br>


### Other thoughts

<br>

#### (a) Most used stations

The horizontal bar chart below shows the 2018 top 10 most popular stations (either start or stop) in Jersey City. It complements the geospatial plot above in quantifying demand for service at each station. This enables the business to determine if further resources are required at popular stations and if less sought after stations can be consolidated in to fewer stations. 

Station 3186 clearly dominates with almost double the traffic of the 2nd placed station (3203). 

Investigating station usage in the context of location, bike availability and docking station availability may provide opportunities for growth or cost savings. 

<br>

```{r}
start_stations <- select(nyc_bikes_df, start_station) %>%   
  rename(station = start_station)

end_stations <- select(nyc_bikes_df, end_station) %>%   
  rename(station = end_station)

stations <- bind_rows(start_stations, end_stations) %>% 
  group_by(station) %>% 
  summarise(count = n()) %>% 
  slice_max(count, n = 10)

stations %>% 
  ggplot() + 
  aes(x = count, y = reorder(station, count)) + 
  geom_col(fill = "light blue") +
  labs(
    x = "\nbike hires", 
    y = "station id\n", 
    title = "2018: Top 10 most used stations (either start or stop)"
  ) +
  theme_grey() +
  theme(plot.title = element_text(size = 12))
```
<br>

#### (b) Pattern of ride times

The bar chart below shows the number of hires made in the year and the length of time of each hire. 

The most common ride time is 5 minutes. Indeed, all of the top 10 ride times are 12 minutes or under.

This information allows the business to better understand their existing customers and their needs and so tailor their product to suit these customers. It also identifies ride times that their bikes are used less for. The business may feel there is an opportunity to provide an offering or product mix that would boost demand for longer ride times, or not as the case may be. Regardless, the information is there for the business to use either way. 

<br>

```{r, warning=FALSE}
nyc_bikes_df %>% 
  ggplot() +
  aes(x = ride_time) + 
  geom_bar(fill = "light blue") +
  scale_x_continuous(
    breaks = c(0, 5, 10, 15, 20, 25, 30, 35, 40, 45, 50, 55, 60), 
    limits = c(1,60)
  ) +
  labs(
    x = "\nride time", 
    y = "bike hires\n", 
    title = "2018 Bike hires by ride times"
  ) +
  theme_grey() +
  theme(plot.title = element_text(size = 12))
```

<br>

#### (c) Ethical considerations

The data set is publicly available and includes tracking information as well as age and gender. 

These could in theory be linked back to an account as the `bike id` is also included. 

Consideration should be given to fully anonymising the data set and disclosing to the user the extent to which their data will be publicly available. 

<br> 

### Conclusions

<br>
To track demand effectively, the business should monitor bike hire rates:

* per time period (hour/day/month) 

* per gender

* per age group

<br>
Slicing their target market by time-period/gender/age group will also allow the business to engage with the different segments of their market and answers questions such as:


* why people hire/don't hire NYC bikes?

* what journeys people make in the city?

* if there is demand for NYC bikes in more suburban areas?

Better understanding customer needs will allow the business to continually adapt their offering to meet demand. 

<br> <br> <br>


